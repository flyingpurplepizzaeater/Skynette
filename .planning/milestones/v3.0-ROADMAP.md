# Milestone v3.0: Agent

**Status:** SHIPPED 2026-01-27
**Phases:** 7-16
**Total Plans:** 47

## Overview

Skynette v3.0 transforms the AI workspace into a general-purpose autonomous assistant. The roadmap progresses from foundational agent infrastructure through MCP-based tool extensibility, safety systems, and configurable autonomy levels. Each phase delivers a coherent, verifiable capability that builds toward the goal: an agent that can build apps, browse the web, interact with external services, and execute multi-step tasks with appropriate human oversight.

## Phases

### Phase 7: Agent Core Infrastructure

**Goal**: Establish the foundational data structures and systems that all agent capabilities build upon
**Depends on**: v2.0 (existing multi-provider gateway, workflow engine)
**Requirements**: AGNT-01, AGNT-02, AGNT-04, AGNT-05, AI-03
**Plans**: 3 plans

Plans:
- [x] 07-01-PLAN.md - Agent data models (state, plan, events)
- [x] 07-02-PLAN.md - Tool infrastructure (registry, base class, mock tool)
- [x] 07-03-PLAN.md - Agent runtime (budget, events, planner, executor)

**Details:**
- Created AgentState, AgentPlan, AgentStep, AgentEvent models
- Built ToolRegistry singleton following NodeRegistry pattern
- Implemented TokenBudget tracking with 50K default limit
- AgentEventEmitter with bounded queues and async subscription
- AgentPlanner for AI-driven task decomposition
- AgentExecutor with tenacity retry logic (3 attempts, exponential jitter)

### Phase 8: Planning and Execution

**Goal**: Agent can plan, execute, and report on multi-step tasks with model flexibility
**Depends on**: Phase 7
**Requirements**: AGNT-03, AGNT-06, AGNT-07, AI-01, AI-02, QUAL-01
**Plans**: 3 plans

Plans:
- [x] 08-01-PLAN.md - Trace storage and enhanced events (observability foundation)
- [x] 08-02-PLAN.md - Cancellation controls and status display (user visibility)
- [x] 08-03-PLAN.md - Model routing and unit tests (intelligence and quality)

**Details:**
- TraceStore with SQLite WAL mode, 30-day retention
- CancelMode (IMMEDIATE, AFTER_CURRENT) and ResultMode (KEEP, DISCARD)
- StatusIndicator component with thinking spinner
- ModelRouter with keyword-based task classification
- 34 unit tests for agent core components

### Phase 9: MCP Integration

**Goal**: Agent can discover and use tools from external MCP servers
**Depends on**: Phase 7
**Requirements**: MCP-01, MCP-02, MCP-03, MCP-04, MCP-05, MCP-06, MCP-07, QUAL-02
**Plans**: 6 plans

Plans:
- [x] 09-01-PLAN.md - MCP models, storage, and curated server definitions
- [x] 09-02-PLAN.md - MCP client manager with stdio and HTTP transports
- [x] 09-03-PLAN.md - Tool adapter and registry integration
- [x] 09-04-PLAN.md - Docker sandbox for untrusted servers
- [x] 09-05-PLAN.md - Server management UI (settings view and dialogs)
- [x] 09-06-PLAN.md - Unit and integration tests

**Details:**
- MCPServerConfig with stdio/HTTP transport support
- Official MCP SDK client integration (mcp>=1.25.0)
- Namespaced tool names with 8-char server ID prefix
- Docker-based sandbox with network disabled by default
- 62 tests covering models, storage, adapter, integration

### Phase 10: Built-in Tools

**Goal**: Agent has concrete capabilities for web search, browsing, code, and GitHub
**Depends on**: Phase 7, Phase 9 (tool registry)
**Requirements**: TOOL-01, TOOL-02, TOOL-03, TOOL-04, TOOL-05, TOOL-06, QUAL-03
**Plans**: 6 plans

Plans:
- [x] 10-01-PLAN.md - Foundation utilities (path validation, backup) and dependencies
- [x] 10-02-PLAN.md - Web search tool with DuckDuckGo and scraper fallback
- [x] 10-03-PLAN.md - Filesystem tools (read, write, delete, list) with security
- [x] 10-04-PLAN.md - Code execution tool with multi-language support
- [x] 10-05-PLAN.md - Browser automation (Playwright) and GitHub integration
- [x] 10-06-PLAN.md - Skynette system tools (RAG) and security tests (QUAL-03)

**Details:**
- Path validation with allowlist + blocked patterns
- DuckDuckGo search with 5-minute TTL cache
- Binary file detection and base64 encoding
- Multi-language code execution (Python, JS, Bash, PowerShell)
- BrowserManager singleton with Playwright stealth
- PyGithub integration with asyncio.to_thread

### Phase 11: Safety and Approval Systems

**Goal**: User has control over what agent can do with appropriate oversight
**Depends on**: Phase 8, Phase 10 (actions to approve)
**Requirements**: SAFE-01, SAFE-02, SAFE-03, SAFE-04, SAFE-05, SAFE-06, QUAL-04
**Plans**: 7 plans

Plans:
- [x] 11-01-PLAN.md - Classification models and ActionClassifier (risk levels, rules)
- [x] 11-02-PLAN.md - Kill switch with multiprocessing.Event (emergency stop)
- [x] 11-03-PLAN.md - Approval models and ApprovalManager (HITL flow)
- [x] 11-04-PLAN.md - Audit store with SQLite persistence (logging, query, export)
- [x] 11-05-PLAN.md - Approval UI components (RiskBadge, ApprovalSheet)
- [x] 11-06-PLAN.md - Executor integration (wire safety into execution loop)
- [x] 11-07-PLAN.md - E2E tests for safety systems (QUAL-04)

**Details:**
- ActionClassifier with safe/moderate/destructive/critical levels
- Kill switch via Ctrl+Shift+K (Cmd+Shift+K on macOS)
- ApprovalManager with asyncio.Event blocking
- AuditStore with 30-day retention, JSON/CSV export
- RiskBadge and ApprovalSheet UI components
- 18 E2E tests for safety workflows

### Phase 12: UI Integration

**Goal**: Agent capabilities are accessible through intuitive UI with full visibility
**Depends on**: Phase 8, Phase 11 (events and approvals)
**Requirements**: UI-01, UI-02, UI-03, UI-04, UI-05, UI-06, QUAL-05
**Plans**: 7 plans

Plans:
- [x] 12-01-PLAN.md - AgentPanel core (resizable sidebar, event subscription, preferences)
- [x] 12-02-PLAN.md - Step views (checklist, timeline, cards with animated switching)
- [x] 12-03-PLAN.md - Plan views (list, tree with dependency visualization)
- [x] 12-04-PLAN.md - Enhanced ApprovalSheet (editing, detail levels, batch approval)
- [x] 12-05-PLAN.md - Audit trail view (scrollable, filterable, real-time updates)
- [x] 12-06-PLAN.md - Task history with replay capability
- [x] 12-07-PLAN.md - Main app integration and E2E tests (QUAL-05)

**Details:**
- AgentPanel with resizable sidebar (280-600px width)
- AnimatedSwitcher for smooth view transitions
- Three step view modes: checklist, timeline, cards
- Approval detail levels: minimal, detailed, progressive
- TaskHistory with 50-char truncation, pagination
- Performance benchmarks: <100ms panel, <200ms 100-steps

### Phase 13: Autonomy Levels

**Goal**: Users can configure how much oversight agent requires (L1-L4)
**Depends on**: Phase 11 (approval system)
**Requirements**: AUTO-01, AUTO-02, AUTO-03, AUTO-04
**Plans**: 7 plans

Plans:
- [x] 13-01-PLAN.md - Autonomy models and service (AutonomyLevel, thresholds, service)
- [x] 13-02-PLAN.md - Storage schema (project_autonomy table, persistence)
- [x] 13-03-PLAN.md - Autonomy-aware classification (dynamic approval based on level)
- [x] 13-04-PLAN.md - Allowlist/blocklist rules (pattern-based overrides)
- [x] 13-05-PLAN.md - UI components (AutonomyBadge, quick toggle in panel)
- [x] 13-06-PLAN.md - Executor integration (project_path, mid-task changes)
- [x] 13-07-PLAN.md - Unit tests (comprehensive coverage)

**Details:**
- L1 Assistant to L4 Expert autonomy levels
- L2 Collaborator as default for new projects
- Blocklist rules always take priority over allowlist
- fnmatch for glob pattern matching
- PopupMenuButton for autonomy level selection
- 37 unit tests for autonomy functionality

### Phase 14: YOLO Mode

**Goal**: Power users can run agent fully autonomously with monitoring
**Depends on**: Phase 11, Phase 13 (safety infrastructure proven)
**Requirements**: AUTO-05, SAFE-07
**Plans**: 6 plans

Plans:
- [x] 14-01-PLAN.md - L5 types, constants, and SandboxDetector utility
- [x] 14-02-PLAN.md - YoloConfirmationDialog component
- [x] 14-03-PLAN.md - Classification L5 bypass and session-only behavior
- [x] 14-04-PLAN.md - Enhanced audit logging for YOLO mode
- [x] 14-05-PLAN.md - UI components (badge, toggle, panel) L5 styling
- [x] 14-06-PLAN.md - E2E integration tests

**Details:**
- Purple (#8B5CF6) for L5 color (power mode aesthetic)
- Session-only YOLO via _session_yolo_projects set
- SandboxDetector for Docker, WSL, Codespaces, Gitpod
- YoloConfirmationDialog with warning for non-sandboxed
- 90-day retention for YOLO audit entries (3x standard)
- 38 tests for sandbox and YOLO behavior

### Phase 15: Approval Flow Wiring (INSERTED)

**Goal**: Fix ApprovalManager integration so approval decisions complete the flow
**Depends on**: Phase 11, Phase 12
**Requirements**: SAFE-02
**Gap Closure**: Closes ApprovalManager.resolve() missing method gap from audit
**Plans**: 1 plan

Plans:
- [x] 15-01-PLAN.md - Add resolve() method and verify approval flow

**Details:**
- Added resolve() method to ApprovalManager (approval.py:196-216)
- Routes to approve()/reject() based on decision string
- Timeout decision treated as rejection
- 7 E2E tests verifying resolve() behavior

### Phase 16: MCP Tool Registration (INSERTED)

**Goal**: Wire MCP server tools into ToolRegistry on connect/disconnect
**Depends on**: Phase 9
**Requirements**: MCP-04
**Gap Closure**: Closes MCP tool registration gap from audit
**Plans**: 1 plan

Plans:
- [x] 16-01-PLAN.md - Register/unregister MCP tools and verify execution

**Details:**
- MCPToolBridge coordinator class (tool_bridge.py)
- connect_and_register() and disconnect_and_unregister() methods
- 5.0 second graceful unregister timeout
- Non-blocking MCP initialization via asyncio.create_task
- 14 unit tests for MCPToolBridge

---

## Milestone Summary

**Decimal Phases:**
- Phase 15: Approval Flow Wiring (inserted to close SAFE-02 gap)
- Phase 16: MCP Tool Registration (inserted to close MCP-04 gap)

**Key Decisions:**
- Build custom agent loop (not LangChain/LangGraph) - simplicity, control
- MCP for tool extensibility - standard protocol, community ecosystem
- Plan-and-Execute pattern for agent architecture - proven design
- Literal types instead of Enums for JSON serialization
- SQLite with WAL mode for all storage (traces, audit, autonomy)
- L2 Collaborator as default autonomy (safe actions auto-execute)
- Session-only YOLO (L5 never persisted to storage)

**Issues Resolved:**
- ApprovalManager.resolve() missing method (Phase 15)
- MCP tools not registered in ToolRegistry (Phase 16)

**Technical Debt Incurred:**
- TODO: Load from user settings (filesystem.py:49) - Info severity
- DeprecationWarning: symmetric() needs update for Flet 0.73
- DeprecationWarning: ElevatedButton needs update for Flet 1.0
- Human verification pending for 12 UI behaviors (see audit)

---

_For current project status, see .planning/ROADMAP.md_
