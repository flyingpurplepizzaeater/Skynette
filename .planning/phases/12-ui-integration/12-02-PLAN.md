---
phase: 12-ui-integration
plan: 02
type: execute
wave: 2
depends_on: ["12-01"]
files_modified:
  - src/agent/ui/step_views.py
  - src/agent/ui/agent_panel.py
  - src/agent/ui/__init__.py
autonomous: true

must_haves:
  truths:
    - "User can see steps in checklist view with status icons"
    - "User can switch between checklist, timeline, and cards views"
    - "Step status updates in real-time as events arrive"
    - "Clicking a step shows expanded detail"
    - "View mode persists across sessions"
  artifacts:
    - path: "src/agent/ui/step_views.py"
      provides: "Step view components"
      min_lines: 200
      exports: ["StepChecklistView", "StepTimelineView", "StepCardsView", "StepViewSwitcher"]
  key_links:
    - from: "src/agent/ui/step_views.py"
      to: "PlanStep"
      via: "model import"
      pattern: "from src\\.agent\\.models\\.plan import.*PlanStep"
    - from: "src/agent/ui/agent_panel.py"
      to: "step_views.py"
      via: "StepViewSwitcher integration"
      pattern: "StepViewSwitcher"
---

<objective>
Create step visualization components with three switchable view modes.

Purpose: UI-02 requires progress display showing step completion with user-selectable visualization style.

Output: StepChecklistView, StepTimelineView, StepCardsView, and StepViewSwitcher for animated transitions.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-ui-integration/12-CONTEXT.md
@.planning/phases/12-ui-integration/12-RESEARCH.md

# Models and patterns
@src/agent/models/plan.py
@src/agent/ui/status_indicator.py
@src/ui/theme.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create step view components</name>
  <files>src/agent/ui/step_views.py</files>
  <action>
Create three step visualization components plus a switcher.

**Status icon/color mapping (use for all views):**
```python
STATUS_ICONS = {
    StepStatus.PENDING: ft.Icons.RADIO_BUTTON_UNCHECKED,
    StepStatus.RUNNING: ft.Icons.PLAY_CIRCLE,
    StepStatus.COMPLETED: ft.Icons.CHECK_CIRCLE,
    StepStatus.FAILED: ft.Icons.ERROR,
    StepStatus.SKIPPED: ft.Icons.SKIP_NEXT,
}
STATUS_COLORS = {
    StepStatus.PENDING: Theme.TEXT_MUTED,
    StepStatus.RUNNING: Theme.PRIMARY,
    StepStatus.COMPLETED: Theme.SUCCESS,
    StepStatus.FAILED: Theme.ERROR,
    StepStatus.SKIPPED: Theme.TEXT_SECONDARY,
}
```

**StepChecklistView(ft.ListView):**
- Vertical scrollable list with auto_scroll=True
- Each row: status icon + step number + description
- `update_step(step_id, status)`: Update specific step
- `set_steps(steps: list[PlanStep])`: Replace all steps
- On click: expand to show step.result or step.error

**StepTimelineView(ft.Column):**
- Horizontal stepper style (can be vertical too)
- Each step: circular badge with number, connecting line between
- Running step: animated indicator (pulsing or outlined)
- Completed: filled with check
- Description below each step

**StepCardsView(ft.ListView):**
- Expandable cards for each step
- Collapsed: icon + description + status badge
- Expanded: full details including tool_name, tool_params, result
- Click to toggle expansion

**StepViewSwitcher(ft.AnimatedSwitcher):**
- Constructor takes initial mode and steps
- `set_view_mode(mode: str, steps: list[PlanStep])`: Switch with fade animation
- Properties: duration=200, transition=FADE, switch_in_curve=EASE_OUT
- Store current mode and steps for updates

All views should:
- Accept list[PlanStep] in constructor
- Have update_step() method
- Have set_steps() method
- Use Theme constants for styling
  </action>
  <verify>Python syntax check: `python -m py_compile src/agent/ui/step_views.py`</verify>
  <done>All three views render steps with appropriate styling and animations</done>
</task>

<task type="auto">
  <name>Task 2: Integrate step views into AgentPanel</name>
  <files>src/agent/ui/agent_panel.py</files>
  <action>
Update AgentPanel to include step views and view mode switching.

**Add to __init__:**
- Create StepViewSwitcher instance
- Add view mode dropdown/segmented button in header
- Wire dropdown change to call switcher.set_view_mode()

**Add to header row:**
- ft.Dropdown or ft.SegmentedButton with options: Checklist, Timeline, Cards
- Default from preferences.step_view_mode
- On change: save to preferences, update switcher

**Add to content area:**
- Replace placeholder with Column containing:
  - Status indicator (existing AgentStatusIndicator)
  - Step view switcher
  - Placeholder for audit trail (later)

**Update event handlers:**
- _handle_plan_created(event): Extract steps from event.data["plan"]["steps"], call switcher.set_steps()
- _handle_step_started(event): Update step status to RUNNING
- _handle_step_completed(event): Update step status to COMPLETED
- _handle_tool_result(event): Optionally store result in step

Wire _event_loop to call appropriate handlers based on event.type.
  </action>
  <verify>Python syntax check: `python -m py_compile src/agent/ui/agent_panel.py`</verify>
  <done>AgentPanel displays step views and updates from events</done>
</task>

<task type="auto">
  <name>Task 3: Update exports and test</name>
  <files>src/agent/ui/__init__.py</files>
  <action>
Add exports:
- from src.agent.ui.step_views import StepChecklistView, StepTimelineView, StepCardsView, StepViewSwitcher

Add tests in tests/agent/ui/test_step_views.py:
```python
import pytest
from src.agent.models.plan import PlanStep, StepStatus

def test_checklist_view_creation():
    """Test StepChecklistView creates with steps."""
    from src.agent.ui.step_views import StepChecklistView

    steps = [
        PlanStep(description="Step 1", status=StepStatus.COMPLETED),
        PlanStep(description="Step 2", status=StepStatus.RUNNING),
        PlanStep(description="Step 3", status=StepStatus.PENDING),
    ]
    view = StepChecklistView(steps)
    assert len(view.controls) == 3

def test_view_switcher_mode_change():
    """Test StepViewSwitcher changes mode."""
    from src.agent.ui.step_views import StepViewSwitcher

    steps = [PlanStep(description="Test step")]
    switcher = StepViewSwitcher("checklist", steps)

    switcher.set_view_mode("timeline", steps)
    # Verify content changed (AnimatedSwitcher.content)
    assert switcher.content is not None

def test_step_status_update():
    """Test updating step status."""
    from src.agent.ui.step_views import StepChecklistView

    steps = [PlanStep(id="step-1", description="Step 1", status=StepStatus.PENDING)]
    view = StepChecklistView(steps)

    view.update_step("step-1", StepStatus.COMPLETED)
    assert view._steps[0].status == StepStatus.COMPLETED
```

Run: `python -m pytest tests/agent/ui/test_step_views.py -v`
  </action>
  <verify>pytest tests/agent/ui/test_step_views.py passes</verify>
  <done>Step views exported and tested</done>
</task>

</tasks>

<verification>
- [ ] StepChecklistView renders vertical list with status icons
- [ ] StepTimelineView renders stepper with connecting lines
- [ ] StepCardsView renders expandable cards
- [ ] StepViewSwitcher animates between modes
- [ ] AgentPanel header has view mode selector
- [ ] Step status updates when events received
- [ ] View mode persists to preferences
</verification>

<success_criteria>
Three step view styles available with animated switching. Steps update in real-time from agent events. View mode persists across sessions.
</success_criteria>

<output>
After completion, create `.planning/phases/12-ui-integration/12-02-SUMMARY.md`
</output>
