---
phase: 14-yolo-mode
plan: 02
type: execute
wave: 2
depends_on: ["14-01"]
files_modified:
  - src/agent/ui/yolo_dialog.py
autonomous: true

must_haves:
  truths:
    - "Confirmation dialog appears when selecting L5 (not instant like L1-L4)"
    - "Dialog shows warning about non-sandboxed environment if applicable"
    - "User can choose 'Proceed anyway' or 'Don't warn again'"
  artifacts:
    - path: "src/agent/ui/yolo_dialog.py"
      provides: "YoloConfirmationDialog component"
      exports: ["YoloConfirmationDialog"]
  key_links:
    - from: "src/agent/ui/yolo_dialog.py"
      to: "src/agent/safety/sandbox.py"
      via: "is_sandboxed parameter"
      pattern: "is_sandboxed.*bool"
---

<objective>
Create the YOLO confirmation dialog that appears when enabling L5 mode.

Purpose: Unlike L1-L4 instant switching, L5 requires explicit confirmation. Dialog warns users when not in a sandboxed environment and provides "don't warn again" option.

Output: YoloConfirmationDialog component following CancelDialog patterns.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14-yolo-mode/14-RESEARCH.md
@.planning/phases/14-yolo-mode/14-01-SUMMARY.md
@src/agent/ui/cancel_dialog.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create YoloConfirmationDialog</name>
  <files>src/agent/ui/yolo_dialog.py</files>
  <action>
    Create YOLO confirmation dialog following CancelDialog patterns:

    1. Create `src/agent/ui/yolo_dialog.py`

    2. Import required modules:
       - flet as ft
       - Theme from src.ui.theme
       - Callable from typing

    3. Define YOLO_COLOR constant: `"#8B5CF6"` (purple)

    4. Create `YoloConfirmationDialog(ft.AlertDialog)` class with:
       - Constructor parameters:
         - `is_sandboxed: bool` - whether environment is sandboxed
         - `on_confirm: Callable[[], None]` - callback when user confirms
         - `on_dont_warn_again: Callable[[], None] | None = None` - callback for "don't warn again"

       - Build content:
         - Main warning text: "Actions will execute without approval prompts"
         - If NOT sandboxed, add warning container with amber background:
           - Icon: ft.Icons.WARNING_AMBER
           - Text: "Not detected as sandboxed environment"
           - Container styling: amber background at 20% opacity, rounded corners

       - Actions (buttons):
         - "Cancel" - TextButton, calls `_close()`
         - "Enable YOLO Mode" - ElevatedButton, purple bgcolor, calls `_confirm()`
         - If NOT sandboxed AND on_dont_warn_again provided:
           Insert "Don't warn again" TextButton between Cancel and Enable

       - Dialog properties:
         - modal=True
         - title: "Enable YOLO Mode?" with bold weight
         - actions_alignment: END

    5. Implement `_confirm()` method:
       - Call `on_confirm` callback
       - Call `_close()`

    6. Implement `_dont_warn_again()` method:
       - Call `on_dont_warn_again` callback if provided
       - Call `_confirm()` (also enables YOLO)

    7. Implement `_close()` method:
       - Set self.open = False
       - Call self.update()

    Note: Follow CancelDialog patterns for consistency. The dialog should feel serious but not scary - it's a power mode, not a warning.
  </action>
  <verify>
    Run: `python -c "from src.agent.ui.yolo_dialog import YoloConfirmationDialog; d = YoloConfirmationDialog(is_sandboxed=False, on_confirm=lambda: None); print(f'modal={d.modal}, title={d.title.value}')" `
    Expected: modal=True, title=Enable YOLO Mode?
  </verify>
  <done>YoloConfirmationDialog shows warning content and action buttons based on sandbox status</done>
</task>

<task type="auto">
  <name>Task 2: Add dialog to UI exports</name>
  <files>src/agent/ui/__init__.py</files>
  <action>
    Update the agent UI package exports:

    1. Add import: `from src.agent.ui.yolo_dialog import YoloConfirmationDialog`

    2. Add to `__all__` list: `"YoloConfirmationDialog"`

    This ensures the dialog is accessible when importing from src.agent.ui.
  </action>
  <verify>
    Run: `python -c "from src.agent.ui import YoloConfirmationDialog; print(YoloConfirmationDialog.__name__)"`
    Expected: YoloConfirmationDialog
  </verify>
  <done>YoloConfirmationDialog is exported from src.agent.ui package</done>
</task>

</tasks>

<verification>
- `python -c "from src.agent.ui.yolo_dialog import YoloConfirmationDialog"` imports without error
- Dialog initializes with is_sandboxed=True (no warning shown in content)
- Dialog initializes with is_sandboxed=False (warning container present)
- Actions include Cancel and Enable YOLO Mode buttons
- Dialog has modal=True for blocking interaction
</verification>

<success_criteria>
- YoloConfirmationDialog renders with appropriate warning content
- Sandbox warning only shows when is_sandboxed=False
- "Don't warn again" button only shows for non-sandboxed + callback provided
- Dialog follows CancelDialog styling patterns
- Callbacks are invoked correctly on button clicks
</success_criteria>

<output>
After completion, create `.planning/phases/14-yolo-mode/14-02-SUMMARY.md`
</output>
