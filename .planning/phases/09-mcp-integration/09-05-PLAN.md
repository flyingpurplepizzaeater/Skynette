---
phase: 09-mcp-integration
plan: 05
type: execute
wave: 4
depends_on: ["09-03", "09-04"]
files_modified:
  - src/ui/views/settings_mcp.py
  - src/ui/views/settings.py
  - src/ui/dialogs/mcp_add_server.py
  - src/ui/dialogs/mcp_import_config.py
autonomous: false

must_haves:
  truths:
    - "User can view list of configured MCP servers in settings"
    - "User can add new MCP server via form (manual configuration)"
    - "User can import servers from mcp.json file"
    - "User can enable/disable and delete MCP servers"
    - "Server connection status is displayed (connected, error, etc.)"
  artifacts:
    - path: "src/ui/views/settings_mcp.py"
      provides: "MCP server management settings view"
      exports: ["MCPSettingsView"]
    - path: "src/ui/dialogs/mcp_add_server.py"
      provides: "Dialog for adding new MCP server"
      exports: ["MCPAddServerDialog"]
    - path: "src/ui/dialogs/mcp_import_config.py"
      provides: "Dialog for importing mcp.json"
      exports: ["MCPImportConfigDialog"]
  key_links:
    - from: "src/ui/views/settings.py"
      to: "src/ui/views/settings_mcp.py"
      via: "includes MCP section in settings"
      pattern: "MCPSettingsView"
    - from: "src/ui/views/settings_mcp.py"
      to: "src/agent/mcp/storage/server_storage.py"
      via: "loads/saves server configs"
      pattern: "get_mcp_storage"
---

<objective>
Create the UI for managing MCP server configurations, allowing users to add, import, enable/disable, and delete servers.

Purpose: Per 09-CONTEXT.md (MCP-05), users need a settings UI for server management. This includes both manual form entry AND import from mcp.json file. Servers should be organized by category (not transport type).

Output: MCP settings section in the main settings view with server list, add dialog, and import dialog.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-mcp-integration/09-CONTEXT.md
@.planning/phases/09-mcp-integration/09-01-SUMMARY.md
@.planning/phases/09-mcp-integration/09-03-SUMMARY.md

# UI patterns to follow
@src/ui/views/settings.py
@src/ui/dialogs/collection_dialog.py
@src/ui/theme.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: MCP Add Server Dialog</name>
  <files>
    src/ui/dialogs/mcp_add_server.py
    src/ui/dialogs/__init__.py
  </files>
  <action>
Create the dialog for manually adding a new MCP server.

In `src/ui/dialogs/mcp_add_server.py`:

```python
"""Dialog for adding a new MCP server."""

import flet as ft
from typing import Callable, Optional
from uuid import uuid4

from src.ui.theme import Theme
from src.agent.mcp.models.server import (
    MCPServerConfig,
    TransportType,
    ServerCategory,
)
from src.agent.mcp.models.trust import TrustLevel


class MCPAddServerDialog(ft.AlertDialog):
    """Dialog for configuring and adding a new MCP server."""

    def __init__(
        self,
        on_save: Callable[[MCPServerConfig], None],
        on_cancel: Optional[Callable[[], None]] = None,
    ):
        super().__init__()
        self.modal = True
        self.on_save = on_save
        self.on_cancel = on_cancel

        # Form fields
        self.name_field = ft.TextField(
            label="Server Name",
            hint_text="e.g., My Filesystem Server",
            border_color=Theme.BORDER,
            expand=True,
        )
        self.description_field = ft.TextField(
            label="Description (optional)",
            hint_text="What this server provides",
            border_color=Theme.BORDER,
            expand=True,
        )
        self.transport_dropdown = ft.Dropdown(
            label="Transport",
            value="stdio",
            options=[
                ft.dropdown.Option("stdio", "Local (stdio)"),
                ft.dropdown.Option("http", "Remote (HTTP)"),
            ],
            border_color=Theme.BORDER,
            on_change=self._on_transport_change,
            width=200,
        )
        self.category_dropdown = ft.Dropdown(
            label="Category",
            value="other",
            options=[
                ft.dropdown.Option("browser_tools", "Browser Tools"),
                ft.dropdown.Option("file_tools", "File Tools"),
                ft.dropdown.Option("dev_tools", "Development Tools"),
                ft.dropdown.Option("data_tools", "Data Tools"),
                ft.dropdown.Option("productivity", "Productivity"),
                ft.dropdown.Option("other", "Other"),
            ],
            border_color=Theme.BORDER,
            width=200,
        )

        # Stdio fields
        self.command_field = ft.TextField(
            label="Command",
            hint_text="e.g., npx, node, python",
            border_color=Theme.BORDER,
            expand=True,
        )
        self.args_field = ft.TextField(
            label="Arguments",
            hint_text="Space-separated: -y @package/name --flag",
            border_color=Theme.BORDER,
            expand=True,
        )

        # HTTP fields
        self.url_field = ft.TextField(
            label="URL",
            hint_text="https://mcp.example.com/api",
            border_color=Theme.BORDER,
            expand=True,
            visible=False,
        )

        # Security
        self.sandbox_checkbox = ft.Checkbox(
            label="Enable sandboxing (recommended for untrusted servers)",
            value=True,
        )

        self._build_dialog()

    def _build_dialog(self):
        """Build the dialog content."""
        self.title = ft.Text(
            "Add MCP Server",
            size=18,
            weight=ft.FontWeight.BOLD,
        )

        self.stdio_fields = ft.Column(
            controls=[
                self.command_field,
                self.args_field,
            ],
            spacing=Theme.SPACING_SM,
        )

        self.http_fields = ft.Column(
            controls=[self.url_field],
            spacing=Theme.SPACING_SM,
            visible=False,
        )

        self.content = ft.Container(
            content=ft.Column(
                controls=[
                    ft.Row([self.name_field], spacing=Theme.SPACING_SM),
                    ft.Row([self.description_field], spacing=Theme.SPACING_SM),
                    ft.Divider(height=1, color=Theme.BORDER),
                    ft.Row(
                        [self.transport_dropdown, self.category_dropdown],
                        spacing=Theme.SPACING_MD,
                    ),
                    self.stdio_fields,
                    self.http_fields,
                    ft.Divider(height=1, color=Theme.BORDER),
                    self.sandbox_checkbox,
                ],
                spacing=Theme.SPACING_MD,
                scroll=ft.ScrollMode.AUTO,
            ),
            width=500,
            height=400,
        )

        self.actions = [
            ft.TextButton("Cancel", on_click=self._handle_cancel),
            ft.ElevatedButton(
                "Add Server",
                bgcolor=Theme.PRIMARY,
                color=Theme.TEXT_PRIMARY,
                on_click=self._handle_save,
            ),
        ]

    def _on_transport_change(self, e):
        """Toggle fields based on transport type."""
        is_stdio = self.transport_dropdown.value == "stdio"
        self.stdio_fields.visible = is_stdio
        self.http_fields.visible = not is_stdio
        self.url_field.visible = not is_stdio
        self.update()

    def _handle_cancel(self, e):
        """Handle cancel button."""
        self.open = False
        self.update()
        if self.on_cancel:
            self.on_cancel()

    def _handle_save(self, e):
        """Handle save button - validate and create config."""
        # Validate required fields
        if not self.name_field.value:
            self.name_field.error_text = "Name is required"
            self.update()
            return

        is_stdio = self.transport_dropdown.value == "stdio"

        if is_stdio and not self.command_field.value:
            self.command_field.error_text = "Command is required"
            self.update()
            return

        if not is_stdio and not self.url_field.value:
            self.url_field.error_text = "URL is required"
            self.update()
            return

        # Parse args
        args = []
        if self.args_field.value:
            args = self.args_field.value.split()

        # Create config
        config = MCPServerConfig(
            id=str(uuid4()),
            name=self.name_field.value,
            description=self.description_field.value or None,
            transport=TransportType.STDIO if is_stdio else TransportType.HTTP,
            command=self.command_field.value if is_stdio else None,
            args=args,
            url=self.url_field.value if not is_stdio else None,
            category=ServerCategory(self.category_dropdown.value),
            trust_level=TrustLevel.USER_ADDED,
            sandbox_enabled=self.sandbox_checkbox.value,
        )

        self.open = False
        self.update()
        self.on_save(config)
```

Update `src/ui/dialogs/__init__.py` to export MCPAddServerDialog.
  </action>
  <verify>
```bash
cd C:/Users/karlt/OneDrive/Desktop/Claude/skynette-repo
python -c "
from src.ui.dialogs.mcp_add_server import MCPAddServerDialog
from src.agent.mcp.models.server import MCPServerConfig

# Check dialog can be instantiated
def mock_save(config: MCPServerConfig):
    print(f'Would save: {config.name}')

dialog = MCPAddServerDialog(on_save=mock_save)
print(f'Dialog title: {dialog.title.value if hasattr(dialog.title, \"value\") else dialog.title}')
print('MCPAddServerDialog OK')
"
```
  </verify>
  <done>
MCPAddServerDialog provides form for both stdio and HTTP servers with transport toggle, category selection, and sandbox option.
  </done>
</task>

<task type="auto">
  <name>Task 2: MCP Import Config Dialog</name>
  <files>
    src/ui/dialogs/mcp_import_config.py
  </files>
  <action>
Create the dialog for importing servers from mcp.json file.

In `src/ui/dialogs/mcp_import_config.py`:

```python
"""Dialog for importing MCP servers from mcp.json file."""

import json
import flet as ft
from pathlib import Path
from typing import Callable, Optional

from src.ui.theme import Theme
from src.agent.mcp.models.server import (
    MCPServerConfig,
    TransportType,
    ServerCategory,
)
from src.agent.mcp.models.trust import TrustLevel


def parse_mcp_config(config_path: Path) -> list[MCPServerConfig]:
    """
    Parse mcp.json file and return list of server configs.

    Supports both Claude Desktop and Claude Code mcp.json formats.
    """
    with open(config_path) as f:
        data = json.load(f)

    configs = []
    mcp_servers = data.get("mcpServers", {})

    for name, server_data in mcp_servers.items():
        # Determine transport type
        if "url" in server_data:
            transport = TransportType.HTTP
        else:
            transport = TransportType.STDIO

        config = MCPServerConfig(
            name=name,
            transport=transport,
            command=server_data.get("command"),
            args=server_data.get("args", []),
            env=server_data.get("env", {}),
            url=server_data.get("url"),
            headers=server_data.get("headers", {}),
            trust_level=TrustLevel.USER_ADDED,  # Imported = untrusted
            sandbox_enabled=True,  # Default to sandboxed
            category=ServerCategory.OTHER,  # User can recategorize
        )
        configs.append(config)

    return configs


class MCPImportConfigDialog(ft.AlertDialog):
    """Dialog for importing MCP servers from mcp.json file."""

    def __init__(
        self,
        on_import: Callable[[list[MCPServerConfig]], None],
        on_cancel: Optional[Callable[[], None]] = None,
    ):
        super().__init__()
        self.modal = True
        self.on_import = on_import
        self.on_cancel = on_cancel
        self.parsed_configs: list[MCPServerConfig] = []

        # File picker
        self.file_picker = ft.FilePicker(on_result=self._on_file_picked)

        # Path display
        self.path_field = ft.TextField(
            label="Config File Path",
            hint_text="Select mcp.json file or paste path",
            border_color=Theme.BORDER,
            expand=True,
            on_change=self._on_path_change,
        )

        # Preview area
        self.preview_text = ft.Text(
            "Select a file to preview servers",
            size=12,
            color=Theme.TEXT_SECONDARY,
        )
        self.preview_list = ft.Column(
            controls=[],
            spacing=4,
            scroll=ft.ScrollMode.AUTO,
        )

        self._build_dialog()

    def _build_dialog(self):
        """Build the dialog content."""
        self.title = ft.Text(
            "Import MCP Servers",
            size=18,
            weight=ft.FontWeight.BOLD,
        )

        self.content = ft.Container(
            content=ft.Column(
                controls=[
                    ft.Text(
                        "Import server configurations from a Claude Desktop or Claude Code mcp.json file.",
                        size=12,
                        color=Theme.TEXT_SECONDARY,
                    ),
                    ft.Row(
                        controls=[
                            self.path_field,
                            ft.IconButton(
                                icon=ft.Icons.FOLDER_OPEN,
                                tooltip="Browse",
                                on_click=lambda _: self.file_picker.pick_files(
                                    allowed_extensions=["json"],
                                    dialog_title="Select mcp.json",
                                ),
                            ),
                        ],
                        spacing=Theme.SPACING_SM,
                    ),
                    ft.Divider(height=1, color=Theme.BORDER),
                    ft.Text("Preview:", size=14, weight=ft.FontWeight.W_500),
                    ft.Container(
                        content=ft.Column(
                            controls=[self.preview_text, self.preview_list],
                            spacing=8,
                        ),
                        bgcolor=Theme.SURFACE,
                        padding=Theme.SPACING_SM,
                        border_radius=Theme.RADIUS_SM,
                        height=200,
                    ),
                    ft.Container(
                        content=ft.Row(
                            controls=[
                                ft.Icon(ft.Icons.WARNING, color=Theme.WARNING, size=16),
                                ft.Text(
                                    "Imported servers will be marked as untrusted and sandboxed by default.",
                                    size=11,
                                    color=Theme.TEXT_SECONDARY,
                                ),
                            ],
                            spacing=8,
                        ),
                    ),
                ],
                spacing=Theme.SPACING_MD,
            ),
            width=500,
            height=420,
        )

        self.actions = [
            self.file_picker,
            ft.TextButton("Cancel", on_click=self._handle_cancel),
            ft.ElevatedButton(
                "Import",
                bgcolor=Theme.PRIMARY,
                color=Theme.TEXT_PRIMARY,
                on_click=self._handle_import,
                disabled=True,
            ),
        ]

    def _on_file_picked(self, e: ft.FilePickerResultEvent):
        """Handle file picker result."""
        if e.files and len(e.files) > 0:
            self.path_field.value = e.files[0].path
            self._parse_and_preview()
            self.update()

    def _on_path_change(self, e):
        """Handle manual path entry."""
        self._parse_and_preview()

    def _parse_and_preview(self):
        """Parse the config file and show preview."""
        path = self.path_field.value
        if not path:
            return

        try:
            config_path = Path(path)
            if not config_path.exists():
                self.preview_text.value = "File not found"
                self.preview_text.color = Theme.ERROR
                self.preview_list.controls = []
                self.parsed_configs = []
                self._update_import_button()
                self.update()
                return

            self.parsed_configs = parse_mcp_config(config_path)

            if not self.parsed_configs:
                self.preview_text.value = "No servers found in file"
                self.preview_text.color = Theme.WARNING
                self.preview_list.controls = []
            else:
                self.preview_text.value = f"Found {len(self.parsed_configs)} server(s):"
                self.preview_text.color = Theme.TEXT_SECONDARY
                self.preview_list.controls = [
                    ft.Row(
                        controls=[
                            ft.Icon(
                                ft.Icons.CHECK_CIRCLE_OUTLINE,
                                color=Theme.SUCCESS,
                                size=16,
                            ),
                            ft.Text(
                                f"{c.name} ({c.transport.value})",
                                size=12,
                            ),
                        ],
                        spacing=8,
                    )
                    for c in self.parsed_configs
                ]

        except json.JSONDecodeError:
            self.preview_text.value = "Invalid JSON file"
            self.preview_text.color = Theme.ERROR
            self.preview_list.controls = []
            self.parsed_configs = []
        except Exception as e:
            self.preview_text.value = f"Error: {str(e)}"
            self.preview_text.color = Theme.ERROR
            self.preview_list.controls = []
            self.parsed_configs = []

        self._update_import_button()
        self.update()

    def _update_import_button(self):
        """Enable/disable import button based on parsed configs."""
        import_btn = self.actions[-1]
        if isinstance(import_btn, ft.ElevatedButton):
            import_btn.disabled = len(self.parsed_configs) == 0

    def _handle_cancel(self, e):
        """Handle cancel button."""
        self.open = False
        self.update()
        if self.on_cancel:
            self.on_cancel()

    def _handle_import(self, e):
        """Handle import button."""
        if self.parsed_configs:
            self.open = False
            self.update()
            self.on_import(self.parsed_configs)
```

Update `src/ui/dialogs/__init__.py` to export MCPImportConfigDialog.
  </action>
  <verify>
```bash
cd C:/Users/karlt/OneDrive/Desktop/Claude/skynette-repo
python -c "
from src.ui.dialogs.mcp_import_config import MCPImportConfigDialog, parse_mcp_config
from src.agent.mcp.models.server import MCPServerConfig
import tempfile
import json

# Test parse function
with tempfile.NamedTemporaryFile(mode='w', suffix='.json', delete=False) as f:
    json.dump({
        'mcpServers': {
            'filesystem': {
                'command': 'npx',
                'args': ['-y', '@modelcontextprotocol/server-filesystem', '/tmp']
            },
            'remote': {
                'url': 'https://mcp.example.com'
            }
        }
    }, f)
    temp_path = f.name

from pathlib import Path
configs = parse_mcp_config(Path(temp_path))
print(f'Parsed {len(configs)} configs')
for c in configs:
    print(f'  - {c.name}: {c.transport.value}')

Path(temp_path).unlink()
print('MCPImportConfigDialog OK')
"
```
  </verify>
  <done>
MCPImportConfigDialog parses mcp.json format, shows preview of servers to import, and marks them as USER_ADDED with sandboxing.
  </done>
</task>

<task type="auto">
  <name>Task 3: MCP Settings View</name>
  <files>
    src/ui/views/settings_mcp.py
    src/ui/views/settings.py
  </files>
  <action>
Create the MCP settings section that shows server list and provides management controls.

In `src/ui/views/settings_mcp.py`:

```python
"""MCP Server settings view."""

import asyncio
import flet as ft
from typing import Optional

from src.ui.theme import Theme
from src.agent.mcp.storage.server_storage import get_mcp_storage
from src.agent.mcp.models.server import MCPServerConfig, MCPServerStatus, ServerCategory
from src.agent.mcp.models.trust import TrustLevel
from src.agent.mcp.curated.servers import list_curated_servers
from src.ui.dialogs.mcp_add_server import MCPAddServerDialog
from src.ui.dialogs.mcp_import_config import MCPImportConfigDialog


class MCPSettingsView(ft.Column):
    """MCP Server management settings section."""

    def __init__(self):
        super().__init__()
        self.spacing = Theme.SPACING_MD
        self.storage = get_mcp_storage()
        self.servers: list[MCPServerConfig] = []
        self._status_cache: dict[str, MCPServerStatus] = {}

    def did_mount(self):
        """Load servers when view mounts."""
        self._load_servers()
        self.update()

    def _load_servers(self):
        """Load server configs from storage."""
        self.servers = self.storage.list_servers()

    def build(self):
        """Build the MCP settings UI."""
        return ft.Column(
            controls=[
                self._build_header(),
                self._build_server_list(),
            ],
            spacing=Theme.SPACING_MD,
        )

    def _build_header(self):
        """Build header with action buttons."""
        return ft.Row(
            controls=[
                ft.Column(
                    controls=[
                        ft.Text(
                            "MCP Servers",
                            size=16,
                            weight=ft.FontWeight.W_600,
                            color=Theme.TEXT_PRIMARY,
                        ),
                        ft.Text(
                            "Connect to external tool servers",
                            size=12,
                            color=Theme.TEXT_SECONDARY,
                        ),
                    ],
                    spacing=2,
                    expand=True,
                ),
                ft.PopupMenuButton(
                    items=[
                        ft.PopupMenuItem(
                            text="Add Server",
                            icon=ft.Icons.ADD,
                            on_click=self._show_add_dialog,
                        ),
                        ft.PopupMenuItem(
                            text="Import from mcp.json",
                            icon=ft.Icons.FILE_UPLOAD,
                            on_click=self._show_import_dialog,
                        ),
                        ft.PopupMenuItem(),  # Divider
                        ft.PopupMenuItem(
                            text="Add Curated Servers",
                            icon=ft.Icons.STAR,
                            on_click=self._show_curated_dialog,
                        ),
                    ],
                    icon=ft.Icons.MORE_VERT,
                ),
            ],
        )

    def _build_server_list(self):
        """Build the list of configured servers."""
        if not self.servers:
            return ft.Container(
                content=ft.Column(
                    controls=[
                        ft.Icon(ft.Icons.EXTENSION_OFF, size=48, color=Theme.TEXT_MUTED),
                        ft.Text(
                            "No MCP servers configured",
                            size=14,
                            color=Theme.TEXT_SECONDARY,
                        ),
                        ft.Text(
                            "Add servers to extend agent capabilities",
                            size=12,
                            color=Theme.TEXT_MUTED,
                        ),
                    ],
                    horizontal_alignment=ft.CrossAxisAlignment.CENTER,
                    spacing=8,
                ),
                padding=Theme.SPACING_LG,
                alignment=ft.alignment.center,
            )

        # Group by category
        by_category: dict[ServerCategory, list[MCPServerConfig]] = {}
        for server in self.servers:
            cat = server.category
            if cat not in by_category:
                by_category[cat] = []
            by_category[cat].append(server)

        controls = []
        for category, servers in sorted(by_category.items(), key=lambda x: x[0].value):
            controls.append(
                ft.Text(
                    category.value.replace("_", " ").title(),
                    size=12,
                    color=Theme.TEXT_SECONDARY,
                    weight=ft.FontWeight.W_500,
                )
            )
            for server in servers:
                controls.append(self._build_server_row(server))
            controls.append(ft.Container(height=8))  # Spacing

        return ft.Container(
            content=ft.Column(controls=controls, spacing=4),
            bgcolor=Theme.SURFACE,
            padding=Theme.SPACING_MD,
            border_radius=Theme.RADIUS_MD,
            border=ft.Border.all(1, Theme.BORDER),
        )

    def _build_server_row(self, server: MCPServerConfig):
        """Build a single server row."""
        # Trust level icon
        if server.trust_level == TrustLevel.BUILTIN:
            trust_icon = ft.Icon(ft.Icons.VERIFIED, color=Theme.PRIMARY, size=16)
            trust_tooltip = "Built-in"
        elif server.trust_level == TrustLevel.VERIFIED:
            trust_icon = ft.Icon(ft.Icons.VERIFIED_USER, color=Theme.SUCCESS, size=16)
            trust_tooltip = "Verified"
        else:
            trust_icon = ft.Icon(ft.Icons.SHIELD_OUTLINED, color=Theme.WARNING, size=16)
            trust_tooltip = "User-added (sandboxed)" if server.sandbox_enabled else "User-added"

        # Connection status
        status = self._status_cache.get(server.id)
        if status and status.connected:
            status_icon = ft.Icon(ft.Icons.CIRCLE, color=Theme.SUCCESS, size=8)
            status_text = f"{status.tools_count} tools"
        elif status and status.error:
            status_icon = ft.Icon(ft.Icons.CIRCLE, color=Theme.ERROR, size=8)
            status_text = "Error"
        else:
            status_icon = ft.Icon(ft.Icons.CIRCLE_OUTLINED, color=Theme.TEXT_MUTED, size=8)
            status_text = "Not connected"

        return ft.Container(
            content=ft.Row(
                controls=[
                    ft.Tooltip(message=trust_tooltip, content=trust_icon),
                    ft.Column(
                        controls=[
                            ft.Text(server.name, size=14, weight=ft.FontWeight.W_500),
                            ft.Row(
                                controls=[
                                    status_icon,
                                    ft.Text(status_text, size=11, color=Theme.TEXT_SECONDARY),
                                    ft.Text(
                                        f" | {server.transport.value}",
                                        size=11,
                                        color=Theme.TEXT_MUTED,
                                    ),
                                ],
                                spacing=4,
                            ),
                        ],
                        spacing=2,
                        expand=True,
                    ),
                    ft.Switch(
                        value=server.enabled,
                        active_color=Theme.PRIMARY,
                        on_change=lambda e, s=server: self._toggle_server(s, e.control.value),
                    ),
                    ft.IconButton(
                        icon=ft.Icons.DELETE_OUTLINE,
                        icon_color=Theme.TEXT_SECONDARY,
                        tooltip="Remove",
                        on_click=lambda _, s=server: self._delete_server(s),
                    ),
                ],
                spacing=Theme.SPACING_SM,
            ),
            padding=ft.padding.symmetric(vertical=4, horizontal=8),
            border_radius=Theme.RADIUS_SM,
            on_hover=lambda e: self._on_row_hover(e),
        )

    def _on_row_hover(self, e):
        """Handle row hover effect."""
        e.control.bgcolor = Theme.SURFACE_HOVER if e.data == "true" else None
        e.control.update()

    def _show_add_dialog(self, e):
        """Show add server dialog."""
        dialog = MCPAddServerDialog(on_save=self._save_server)
        self.page.overlay.append(dialog)
        dialog.open = True
        self.page.update()

    def _show_import_dialog(self, e):
        """Show import dialog."""
        dialog = MCPImportConfigDialog(on_import=self._import_servers)
        self.page.overlay.append(dialog)
        dialog.open = True
        self.page.update()

    def _show_curated_dialog(self, e):
        """Show curated servers selection."""
        # Get curated servers not already added
        curated = list_curated_servers()
        existing_names = {s.name for s in self.servers}
        available = [c for c in curated if c.name not in existing_names]

        if not available:
            self.page.snack_bar = ft.SnackBar(
                content=ft.Text("All curated servers already added"),
            )
            self.page.snack_bar.open = True
            self.page.update()
            return

        # Simple selection dialog
        selected = []

        def on_select(config):
            selected.append(config)

        items = []
        for config in available:
            items.append(
                ft.ListTile(
                    leading=ft.Checkbox(
                        value=False,
                        on_change=lambda e, c=config: (
                            selected.append(c) if e.control.value else selected.remove(c)
                        ),
                    ),
                    title=ft.Text(config.name),
                    subtitle=ft.Text(config.description or "", size=11),
                )
            )

        dialog = ft.AlertDialog(
            title=ft.Text("Add Curated Servers"),
            content=ft.Container(
                content=ft.Column(controls=items, scroll=ft.ScrollMode.AUTO),
                width=400,
                height=300,
            ),
            actions=[
                ft.TextButton("Cancel", on_click=lambda _: self._close_dialog(dialog)),
                ft.ElevatedButton(
                    "Add Selected",
                    bgcolor=Theme.PRIMARY,
                    on_click=lambda _: self._add_curated(dialog, selected),
                ),
            ],
        )
        self.page.overlay.append(dialog)
        dialog.open = True
        self.page.update()

    def _close_dialog(self, dialog):
        """Close a dialog."""
        dialog.open = False
        self.page.update()

    def _add_curated(self, dialog, selected):
        """Add selected curated servers."""
        dialog.open = False
        for config in selected:
            self.storage.save_server(config)
        self._load_servers()
        self.page.update()

    def _save_server(self, config: MCPServerConfig):
        """Save a new server config."""
        self.storage.save_server(config)
        self._load_servers()
        self.page.snack_bar = ft.SnackBar(
            content=ft.Text(f"Added server: {config.name}"),
        )
        self.page.snack_bar.open = True
        self.update()
        self.page.update()

    def _import_servers(self, configs: list[MCPServerConfig]):
        """Import multiple server configs."""
        for config in configs:
            self.storage.save_server(config)
        self._load_servers()
        self.page.snack_bar = ft.SnackBar(
            content=ft.Text(f"Imported {len(configs)} server(s)"),
        )
        self.page.snack_bar.open = True
        self.update()
        self.page.update()

    def _toggle_server(self, server: MCPServerConfig, enabled: bool):
        """Toggle server enabled state."""
        server.enabled = enabled
        self.storage.save_server(server)
        self.update()

    def _delete_server(self, server: MCPServerConfig):
        """Delete a server config."""
        self.storage.delete_server(server.id)
        self._load_servers()
        self.page.snack_bar = ft.SnackBar(
            content=ft.Text(f"Removed server: {server.name}"),
        )
        self.page.snack_bar.open = True
        self.update()
        self.page.update()
```

Update `src/ui/views/settings.py`:
1. Import MCPSettingsView
2. Add MCP section to the settings layout

In settings.py `build()` method, add after existing sections:
```python
self._build_section("MCP Servers", MCPSettingsView()),
```

And add import at top:
```python
from src.ui.views.settings_mcp import MCPSettingsView
```
  </action>
  <verify>
```bash
cd C:/Users/karlt/OneDrive/Desktop/Claude/skynette-repo
python -c "
from src.ui.views.settings_mcp import MCPSettingsView
from src.ui.views.settings import SettingsView

# Check MCPSettingsView can be instantiated
mcp_view = MCPSettingsView()
print(f'MCPSettingsView created')

# Check SettingsView still works
settings_view = SettingsView()
print(f'SettingsView created')
print('Settings views OK')
"
```
  </verify>
  <done>
MCPSettingsView displays servers grouped by category with trust icons, connection status, enable/disable switches, and delete buttons. Integrates with main settings view.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>MCP server management UI in settings with add, import, and curated server features</what-built>
  <how-to-verify>
1. Run the application: `python -m src.main` (or however the app starts)
2. Navigate to Settings
3. Find the "MCP Servers" section
4. Verify:
   - "No MCP servers configured" message shows initially
   - Click menu (three dots) -> "Add Server" opens form dialog
   - Form has fields for name, transport (stdio/HTTP), command/URL, category
   - Click menu -> "Import from mcp.json" opens file picker dialog
   - Click menu -> "Add Curated Servers" shows list of vetted servers
5. Add a test server and verify it appears in the list with:
   - Trust icon (shield for user-added)
   - Enable/disable toggle
   - Delete button
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues with the UI</resume-signal>
</task>

</tasks>

<verification>
After all tasks complete:

1. Dialogs instantiate:
```bash
python -c "
from src.ui.dialogs.mcp_add_server import MCPAddServerDialog
from src.ui.dialogs.mcp_import_config import MCPImportConfigDialog
print('Dialogs OK')
"
```

2. Settings view builds:
```bash
python -c "
from src.ui.views.settings_mcp import MCPSettingsView
view = MCPSettingsView()
print('MCPSettingsView OK')
"
```

3. Settings includes MCP section:
```bash
python -c "
from src.ui.views.settings import SettingsView
# Just verify import works
print('SettingsView imports OK')
"
```
</verification>

<success_criteria>
- MCPAddServerDialog provides form for both stdio and HTTP servers
- MCPImportConfigDialog parses mcp.json and shows preview
- MCPSettingsView displays servers grouped by category
- Trust level shown with appropriate icons (verified/warning shield)
- Enable/disable toggle and delete button per server
- Add, Import, and Curated options in menu
- MCP section appears in main settings view
- Human verification: UI is usable and intuitive
</success_criteria>

<output>
After completion, create `.planning/phases/09-mcp-integration/09-05-SUMMARY.md`
</output>
